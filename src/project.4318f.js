window.__require=function t(e,i,n){function s(h,a){if(!i[h]){if(!e[h]){var d=h.split("/");if(d=d[d.length-1],!e[d]){var c="function"==typeof __require&&__require;if(!a&&c)return c(d,!0);if(o)return o(d,!0);throw new Error("Cannot find module '"+h+"'")}h=d}var r=i[h]={exports:{}};e[h][0].call(r.exports,function(t){return s(e[h][1][t]||t)},r,r.exports,t,e,i,n)}return i[h].exports}for(var o="function"==typeof __require&&__require,h=0;h<n.length;h++)s(n[h]);return s}({camera:[function(t,e,i){"use strict";cc._RF.push(e,"4d29cDgQd5MYLKrNf4zHdzA","camera");var n=t("common"),s=1.2,o=1,h=3;cc.Class({extends:cc.Component,properties:{mainCamera:cc.Camera},onLoad:function(){this.boundary=n.boundary,this.cameraBoundary=this.boundary-cc.winSize.width/2,this.CameraTime=0,this.onScale=!1},update:function(t){this.updateCamera(t)},updateCamera:function(t){var e=this.node.x;this.node._State!==n.State.IDLE||this.checkBoundary(e)?(this.CameraTime=0,this.mainCamera.zoomRatio>o?this.mainCamera.zoomRatio-=.01:this.mainCamera.zoomRatio=o):(this.CameraTime+=t,this.CameraTime>=h&&this.mainCamera.zoomRatio<s&&(this.mainCamera.zoomRatio+=.002)),this.checkBoundary(e)||(this.mainCamera.node.x=e)},checkBoundary:function(t){return t<=-this.cameraBoundary||t>=this.cameraBoundary}}),cc._RF.pop()},{common:"common"}],common:[function(t,e,i){"use strict";cc._RF.push(e,"20e80cxYaxN3qC3MdWcjEFq","common");var n=cc.Enum({IDLE:1,ATTACK:2,MOVE:3,DODGE:4});e.exports={State:n,checkCollide:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return!(!e||t.x-t.cW.x-i>e.x+e.cW.x||t.x+t.cW.x+i<e.x-e.cW.x||t.y>e.y+e.cW.y||t.y+t.cW.y<e.y)},boundary:1620},cc._RF.pop()},{}],enemy:[function(t,e,i){"use strict";cc._RF.push(e,"82a67bpbAdPj5396sdeKOCX","enemy");var n=t("common");cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.node.cW={x:this.node.width/2,y:this.node.height},this.dbDisplay=this.node.getChildByName("body").getComponent(dragonBones.ArmatureDisplay),this.dbArmature=this.dbDisplay.armature(),this.dbDisplay.on(dragonBones.EventObject.COMPLETE,this.aniComplete,this),this.dbDisplay.on(dragonBones.EventObject.FRAME_EVENT,this.frameEvent,this),this.game=this.node.parent.getComponent("game"),this.hero=this.node.parent.getChildByName("hero"),this.node.scaleX=-1*this.hero.scaleX,this.node.isDie=!1,this.moveSpeed=3,this.speed=0,this.thinkTime=2,this.thinkCurTime=0,this.State=n.State.IDLE},update:function(t){this.node.isDie||this.hero.isDie||(this.State===n.State.IDLE&&(this.thinkCurTime+=t,this.thinkCurTime>=this.thinkTime&&(this.thinkCurTime=0,this.nextStep())),0!==this.speed&&this.move())},init:function(){this.ROLE={hp:100,att:5}},frameEvent:function(t){"attack"===t.name&&n.checkCollide(this.node,this.hero)&&this.hero.getComponent("hero").uatt(this.ROLE.att)},aniComplete:function(t){this.idleAni()},removeOn:function(){this.dbDisplay.off(dragonBones.EventObject.COMPLETE,this,aniComplete,this),this.dbDisplay.off(dragonBones.EventObject.FRAME_EVENT,this,aniComplete,this)},uatt:function(t){var e=this;if(!this.node.isDie){if(this.ROLE.hp-=t,this.ROLE.hp<=0)return this.node.isDie=!0,this.dbDisplay.playAnimation("die"),void this.scheduleOnce(function(){e.node.destroy()},2);this.game.showHit(t,cc.v2(this.node.x,this.node.y+this.node.height)),this.dbArmature.animation.fadeIn("hit",-1,-1,0,"normal")}},idleAni:function(){this.node.isDie||(this.State=n.State.IDLE,this.dbArmature.animation.fadeIn("idle",-1,-1,0,"normal",dragonBones.AnimationFadeOutMode.All))},nextStep:function(){if(!this.hero.isDie){if(this.checkDir(),n.checkCollide(this.node,this.hero))return this.speed=0,void this.attackAni();this.dbArmature.animation.fadeIn("move",-1,-1,0,"normal"),this.State=n.State.MOVE,this.speed=this.moveSpeed*this.node.scaleX}},checkDir:function(){var t=this.node.x<this.hero.x?1:-1;this.node.scaleX=t},attackAni:function(){this.hero.isDie||(this.State=n.State.ATTACK,this.dbArmature.animation.fadeIn("att_1",-1,-1,0,"normal"))},move:function(){if(n.checkCollide(this.node,this.hero))return this.idleAni(),this.speed=0,void this.attackAni();this.node.x+=this.speed}}),cc._RF.pop()},{common:"common"}],game:[function(t,e,i){"use strict";cc._RF.push(e,"b230eltSINPMI/Ry6Ps4Us+","game");var n=t("common");cc.Class({extends:cc.Component,properties:{hitLabel:cc.Prefab,enemyFab:cc.Prefab,enemyCountLabel:cc.Label,blackNode:cc.Node,leftBoss:cc.Node,rightBoss:cc.Node},onLoad:function(){this.hero=this.node.getChildByName("hero"),this.boundary=n.boundary,this.hitPool=new cc.NodePool("hit"),this.canvas=cc.find("Canvas"),this.allEnemy=[[],[]],this.updateTime=0,this.onAddEnemy=!1,this.addEnemyList=[],this.enemyCount=0,this.enemyTotal=5,this.addEnemyCurTime=0,this.addEnemyTime=10},update:function(t){this.hero.isDie||(this.updateTime++,this.addEnemyCurTime+=t,this.updateTime>=2&&(this.updateTime=0,this.updateEnemyList()),this.addEnemyCurTime>=this.addEnemyTime&&(this.addEnemyCurTime=0,this.addEnemy()))},showHit:function(t,e){var i=this,n=this.hitPool.get();n||(n=cc.instantiate(this.hitLabel)),n.parent=this.canvas,n.getComponent(cc.Label).string=t,n.setPosition(cc.v2(e.x,e.y+this.node.y)),n.zIndex=3,cc.tween(n).then(cc.spawn(cc.moveBy(.3,cc.v2(0,100)),cc.scaleTo(.3,1.5))).then(cc.spawn(cc.moveBy(.5,cc.v2(0,100)),cc.scaleTo(.5,1))).call(function(){i.hitPool.put(n)}).start()},randomN:function(t){return Math.floor(Math.random()*t)},addEnemy:function(){if(!(this.enemyCount>=this.enemyTotal)){var t=this.randomN(this.boundary)*(Math.random()<.5?-1:1);this.addEnemyList.push(t),this.addEnemySet()}},addEnemySet:function(){var t=this;if(!(this.addEnemyList.length<1||this.onAddEnemy)){this.onAddEnemy=!0;var e=this.addEnemyList[0];this.addEnemyList.shift(),this.blackNode.setPosition(cc.v2(e,this.node.y+60)),this.blackNode.active=!0;var i=cc.instantiate(this.enemyFab);cc.tween(this.blackNode).parallel(cc.rotateBy(1,360),cc.scaleTo(.5,1)).call(function(){i.parent=t.node,i.setPosition(cc.v2(e,0)),i.getComponent("enemy").init()}).by(.5,{angle:-180}).parallel(cc.rotateBy(1,360),cc.scaleTo(.5,0)).call(function(){t.blackNode.active=!1,t.onAddEnemy=!1,t.addEnemySet()}).start()}},updateEnemyList:function(){var t=this.node.children,e=null;this.leftBoss.active=!1,this.rightBoss.active=!1;for(var i=[[],[]],n=0;n<t.length;n++)(e=t[n]).isDie||"hero"===e.name||(e.x<this.hero.x?(e.x<this.hero.x-360&&(this.leftBoss.active=!0),i[0].push(e)):(e.x>this.hero.x+360&&(this.rightBoss.active=!0),i[1].push(e))),this.allEnemy[0]=i[0],this.allEnemy[1]=i[1],this.allEnemy[0].sort(this.enemyOrder(!0)),this.allEnemy[1].sort(this.enemyOrder(!1)),this.enemyCount=i[0].length+i[1].length,this.enemyCountLabel.string=this.enemyCount},enemyOrder:function(t){return function(e,i){return t?i.x-e.x:e.x-i.x}}}),cc._RF.pop()},{common:"common"}],hero:[function(t,e,i){"use strict";cc._RF.push(e,"50872RRgMFF1oGgM1YBk1PX","hero");var n=t("common"),s=["att_1","att_2","att_3","att_4"],o=["p_fist","p_sword"];cc.Class({extends:cc.Component,properties:{leftButton:cc.Node,rightButton:cc.Node,hpBar:cc.Node,blackNode:cc.Node},onLoad:function(){this.dbDisplay=this.node.getChildByName("body").getComponent(dragonBones.ArmatureDisplay),this.dbArmature=this.dbDisplay.armature(),this.defSkinId=1,this.wepDisplay=cc.find("sword").getComponent(dragonBones.ArmatureDisplay),this.node.zIndex=2,this.node.isDie=!1,this._speed=0,this.moveSpeed=20,this._faceDir=1,this.node._State=n.State.IDLE,this._onButton=!1,this.game=this.node.parent.getComponent("game"),this.boundary=n.boundary,this.attCount=0,this.node.cW={x:this.node.width/2,y:this.node.height},this.dbDisplay.on(dragonBones.EventObject.COMPLETE,this.aniComplete,this),this.dbDisplay.on(dragonBones.EventObject.FRAME_EVENT,this.frameEvent,this),this.enemyList=this.game.allEnemy,this.setEvent(this.leftButton),this.setEvent(this.rightButton),this.init()},update:function(t){this.node.isDie||0!==this._speed&&this.move()},init:function(){this.ROLE={wepId:0,hp:200,att:20,totalHp:200,dodgeLen:200,dodgeSpeed:20},this.idleAni(),this.updateWep()},changeSkin:function(){if(!this.node.isDie){this.defSkinId=this.defSkinId<o.length-1?this.defSkinId+1:0;var t=o[this.defSkinId];this.dbDisplay.armatureName=t,this.dbArmature=this.dbDisplay.armature(),this.updateWep()}},changeWep:function(){if(1===this.defSkinId&&!this.node.isDie){var t=Math.floor(20*Math.random());this.ROLE.wepId=t,this.updateWep()}},updateWep:function(){if(1===this.defSkinId&&!this.node.isDie){var t=this.wepDisplay.buildArmature("s_".concat(this.ROLE.wepId));this.dbArmature.getSlot("sword").childArmature=t.armature()}},aniComplete:function(t){if(!this.node.isDie){var e=this.getEnemy();this._onButton&&n.checkCollide(this.node,e)?this.attackAni():this.idleAni()}},frameEvent:function(t){if(!this.node.isDie&&"attack"===t.name){var e=this.getEnemy();n.checkCollide(this.node,e)&&e.getComponent("enemy").uatt(this.ROLE.att)}},setEvent:function(t){t.on("touchstart",this.touchStart,this),t.on("touchend",this.touchEnd,this),t.on("touchcancel",this.touchEnd,this)},offEvent:function(t){t.off("touchstart",this.touchStart,this),t.off("touchend",this.touchEnd,this),t.off("touchcancel",this.touchEnd,this)},touchStart:function(t){if(this.node._State===n.State.IDLE){this._onButton=!0;var e="left"===t.target.name?-1:1,i=this.getEnemy();n.checkCollide(this.node,i)?this._faceDir==e?this.attackAni():this.dodge(e):(this._faceDir=e,this._speed=this.moveSpeed*e,this.node.scaleX=e,this.node._State=n.State.MOVE,this.dbArmature.animation.fadeIn("move",-1,-1,0,"normal"))}},touchEnd:function(t){this._onButton=!1,this._speed=0,this.node._State===n.State.MOVE&&this.idleAni()},idleAni:function(){this.node.isDie||(this.node._State=n.State.IDLE,this.dbArmature.animation.fadeIn("idle",-1,-1,0,"normal",dragonBones.AnimationFadeOutMode.All))},dodge:function(t){var e=this;this.node._State=n.State.DODGE,this.dbArmature.animation.fadeIn("avoid",-1,-1,0,"normal"),this.blackNode.active=!0;var i=cc.Vec2.distance(this.node.position,cc.v2(this.boundary*t));i=i<this.ROLE.dodgeLen?i:this.ROLE.dodgeLen,cc.tween(this.node).by(.2,{position:cc.v2(i*t,0)}).call(function(){e.blackNode.active=!1,e.idleAni()}).start()},attackAni:function(){if(!this.node.isDie){this.node._State=n.State.ATTACK;var t=s[this.attCount];this.dbArmature.animation.fadeIn(t,-1,-1,0,"normal"),this.attCount=this.attCount<3?this.attCount+1:0}},getEnemy:function(){return this.enemyList[this._faceDir>0?1:0][0]},move:function(){var t=this.getEnemy();if(n.checkCollide(this.node,t)&&(this._faceDir<0&&t.x<=this.node.x||this._faceDir>0&&t.x>=this.node.x))return this._speed=0,void this.attackAni();this.node.x>-this.boundary-this._speed&&this.node.x+this._speed<this.boundary&&(this.node.x+=this._speed)},uatt:function(t){if(!this.node.isDie){var e=this.ROLE.hp-t;this.game.showHit(t,cc.v2(this.node.x,this.node.y+this.node.height)),this.ROLE.hp<=0&&(this.node.isDie=!0,this.offEvent(this.leftButton),this.offEvent(this.rightButton),this.dbDisplay.off(dragonBones.EventObject.COMPLETE,this.aniComplete,this),this.dbDisplay.off(dragonBones.EventObject.FRAME_EVENT,this.frameEvent,this),this.ROLE.hp=0,this.hpBar.width=0,this.dbDisplay.playAnimation("die")),this.hpBar.width=this.ROLE.hp/this.ROLE.totalHp*200,this.ROLE.hp=e}}}),cc._RF.pop()},{common:"common"}]},{},["camera","common","enemy","game","hero"]);